<?xml version="1.0" encoding="UTF-8"?><html xmlns="http://www.w3.org/1999/xhtml" xmlns:xtlcon="http://www.xtpxlib.nl/ns/container">
  
  
  
  
  <head>
    <meta charset="utf-8"/>
    <meta http-equiv="X-UA-Compatible" content="IE=edge"/>
    <meta name="viewport" content="width=device-width, initial-scale=1"/>
    <link rel="stylesheet" href="resources/bootstrap.min.css"/>
    <link rel="stylesheet" href="resources/sticky-footer-navbar.css"/>
    <link rel="stylesheet" href="resources/xtpxlib-moduledoc.css"/>
    <link rel="shortcut icon" href="resources/favicon.ico"/>
    <title>3 XProc Libraries</title>
  </head>
  <body><!-- == START TOC == --><nav class="navbar navbar-default navbar-fixed-top"><div class="container"><div class="navbar-header"><a class="navbar-brand" href="index.html" title="home">xtpxlib-common</a></div><div id="navbar" class="collapse navbar-collapse"><ul class="nav navbar-nav"><li><a href="1_Description.html">1 Description</a></li><li class="dropdown"><a href="2_XSLT_Modules.html" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-haspopup="true" aria-expanded="false">XSLT Modules <span class="caret"/></a><ul class="dropdown-menu"><li><a href="2_XSLT_Modules.html">2 XSLT Modules</a></li><li role="separator" class="divider"/><li><a href="2_XSLT_Modules.html#compare.mod.xsl">2.1 XSLT (2.0): compare.mod.xsl</a></li><li><a href="2_XSLT_Modules.html#date-time.mod.xsl">2.2 XSLT (2.0): date-time.mod.xsl</a></li><li><a href="2_XSLT_Modules.html#format-output.mod.xsl">2.3 XSLT (2.0): format-output.mod.xsl</a></li><li><a href="2_XSLT_Modules.html#general.mod.xsl">2.4 XSLT (2.0): general.mod.xsl</a></li><li><a href="2_XSLT_Modules.html#href.mod.xsl">2.5 XSLT (2.0): href.mod.xsl</a></li><li><a href="2_XSLT_Modules.html#message.mod.xsl">2.6 XSLT (2.0): message.mod.xsl</a></li><li><a href="2_XSLT_Modules.html#mimetypes.mod.xsl">2.7 XSLT (2.0): mimetypes.mod.xsl</a></li><li><a href="2_XSLT_Modules.html#parameters.mod.xsl">2.8 XSLT (3.0): parameters.mod.xsl</a></li><li><a href="2_XSLT_Modules.html#uuid.mod.xsl">2.9 XSLT (2.0): uuid.mod.xsl</a></li></ul></li><li class="dropdown"><a href="3_XProc_Libraries.html" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-haspopup="true" aria-expanded="false">XProc Libraries <span class="caret"/></a><ul class="dropdown-menu"><li><a href="3_XProc_Libraries.html">3 XProc Libraries</a></li><li role="separator" class="divider"/><li><a href="3_XProc_Libraries.html#common.mod.xpl">3.1 XProc (1.0) library: common.mod.xpl</a></li></ul></li><li><a href="resources/xtpxlib-common-documentation.pdf" title="PDF version of this documentation site">PDF</a></li></ul></div></div></nav><!-- == END TOC == --><div class="container"><a name="d6061e4169"><!----></a><div class="page-header"><h1 class="chapter"><span class="chapter-number">3 </span>XProc Libraries</h1></div><div class="sect1" id="common.mod.xpl"><a name="common.mod.xpl"><!----></a><h2 class="sect1"><span class="sect1-number">3.1</span> XProc (1.0) library: <code class="code">common.mod.xpl</code></h2><p class="para">File: <code class="code">xplmod/common.mod/common.mod.xpl</code></p><p class="para">XProc library with generic steps.</p><div class="table"><table class="table"><thead><tr><th><p class="para">Prefix</p></th><th><p class="para">Namespace URI</p></th></tr></thead><tbody><tr><td><p class="para"><code class="code">xtlc</code></p></td><td><p class="para"><code class="code">http://www.xtpxlib.nl/ns/common</code></p></td></tr></tbody></table></div><div class="table"><table class="table"><thead><tr><th><p class="para">Step</p></th><th><p class="para">Description</p></th></tr></thead><tbody><tr><td><p class="para"><code class="code"><a href="#common.mod.xpl-xtlc_copy-directory"><span class="link">xtlc:copy-directory</span></a></code></p></td><td><p class="para">Copies a full directory structure.</p></td></tr><tr><td><p class="para"><code class="code"><a href="#common.mod.xpl-xtlc_copy-file"><span class="link">xtlc:copy-file</span></a></code></p></td><td><p class="para">Copies a file, if necessary from inside a zip file.</p></td></tr><tr><td><p class="para"><code class="code"><a href="#common.mod.xpl-xtlc_log"><span class="link">xtlc:log</span></a></code></p></td><td><p class="para">Writes a message to a log file.</p></td></tr><tr><td><p class="para"><code class="code"><a href="#common.mod.xpl-xtlc_recursive-directory-list"><span class="link">xtlc:recursive-directory-list</span></a></code></p></td><td><p class="para">Returns the contents of a directory, going into sub-directories recursively. When the requested directory does not exist, it returns only a c:directory root element with @error="true".</p></td></tr><tr><td><p class="para"><code class="code"><a href="#common.mod.xpl-xtlc_remove-dir"><span class="link">xtlc:remove-dir</span></a></code></p></td><td><p class="para">Removes a full directory (since the normal processing using pxf:delete does not work properly some older Calabash versions... :-( ) When the directory does not exist everything continues without error.</p></td></tr><tr><td><p class="para"><code class="code"><a href="#common.mod.xpl-xtlc_tee"><span class="link">xtlc:tee</span></a></code></p></td><td><p class="para">Tees the input to a file and passes it unchanged (like the Unix tee command).</p></td></tr><tr><td><p class="para"><code class="code"><a href="#common.mod.xpl-xtlc_zip-directory"><span class="link">xtlc:zip-directory</span></a></code></p></td><td><p class="para">Zips a directory and its sub-directories into a single zip file.</p></td></tr></tbody></table></div><p class="bridgehead" id="common.mod.xpl-xtlc_copy-directory"><a name="common.mod.xpl-xtlc_copy-directory"><!----></a>Step declaration: <code class="code">xtlc:copy-directory</code></p><p class="para">Copies a full directory structure.</p><div class="table"><table class="table"><thead><tr><th><p class="para">Port</p></th><th><p class="para">Type</p></th><th><p class="para">Primary?</p></th><th><p class="para">Description</p></th></tr></thead><tbody><tr><td><p class="para"><code class="code">source</code></p></td><td><p class="para">in</p></td><td><p class="para">yes</p></td><td><p class="para">Input, will be passed unchanged.</p></td></tr><tr><td><p class="para"><code class="code">result</code></p></td><td><p class="para">out</p></td><td><p class="para">yes</p></td><td><p class="para">The input unchanged.</p></td></tr></tbody></table></div><div class="table"><table class="table"><thead><tr><th><p class="para">Option</p></th><th><p class="para">Rq?</p></th><th><p class="para">Default</p></th><th><p class="para">Description</p></th></tr></thead><tbody><tr><td><p class="para"><code class="code">href-source-dir</code></p></td><td><p class="para">yes</p></td><td><p class="para"><code class="code"/></p></td><td><p class="para">Reference to the directory to copy from.</p></td></tr><tr><td><p class="para"><code class="code">href-target-dir</code></p></td><td><p class="para">yes</p></td><td><p class="para"><code class="code"/></p></td><td><p class="para">Reference to the directory to copy to.</p></td></tr></tbody></table></div><p class="bridgehead" id="common.mod.xpl-xtlc_copy-file"><a name="common.mod.xpl-xtlc_copy-file"><!----></a>Step declaration: <code class="code">xtlc:copy-file</code></p><p class="para">Copies a file, if necessary from inside a zip file.</p><p class="para">IMPORTANT: For older versions of Calabash (before January 2017) there is a huge bug in this step: A file inside a zip file must have a straight filename without any characters that normally would have been escaped (like, the most inportant one, spaces).</p><div class="table"><table class="table"><thead><tr><th><p class="para">Port</p></th><th><p class="para">Type</p></th><th><p class="para">Primary?</p></th><th><p class="para">Description</p></th></tr></thead><tbody><tr><td><p class="para"><code class="code">source</code></p></td><td><p class="para">in</p></td><td><p class="para">yes</p></td><td><p class="para">Input, will be passed unchanged.</p></td></tr><tr><td><p class="para"><code class="code">result</code></p></td><td><p class="para">out</p></td><td><p class="para">yes</p></td><td><p class="para">The input unchanged.</p></td></tr></tbody></table></div><div class="table"><table class="table"><thead><tr><th><p class="para">Option</p></th><th><p class="para">Rq?</p></th><th><p class="para">Default</p></th><th><p class="para">Description</p></th></tr></thead><tbody><tr><td><p class="para"><code class="code">enable</code></p></td><td><p class="para"> </p></td><td><p class="para"><code class="code">true()</code></p></td><td><p class="para">Whether the copying is done at all.</p></td></tr><tr><td><p class="para"><code class="code">href-source</code></p></td><td><p class="para">yes</p></td><td><p class="para"><code class="code"/></p></td><td><p class="para">Reference to the source file to copy.</p></td></tr><tr><td><p class="para"><code class="code">href-source-zip</code></p></td><td><p class="para"> </p></td><td><p class="para"><code class="code">''</code></p></td><td><p class="para">Document reference to a zip file. When filled, $href-source is assumed to be a path inside this zip.</p></td></tr><tr><td><p class="para"><code class="code">href-target</code></p></td><td><p class="para">yes</p></td><td><p class="para"><code class="code"/></p></td><td><p class="para">Reference to the target.</p></td></tr></tbody></table></div><p class="bridgehead" id="common.mod.xpl-xtlc_log"><a name="common.mod.xpl-xtlc_log"><!----></a>Step declaration: <code class="code">xtlc:log</code></p><p class="para">Writes a message to a log file.</p><div class="table"><table class="table"><thead><tr><th><p class="para">Port</p></th><th><p class="para">Type</p></th><th><p class="para">Primary?</p></th><th><p class="para">Description</p></th></tr></thead><tbody><tr><td><p class="para"><code class="code">source</code></p></td><td><p class="para">in</p></td><td><p class="para">yes</p></td><td><p class="para">Input to the logging, will be passed unchanged to the output</p></td></tr><tr><td><p class="para"><code class="code">result</code></p></td><td><p class="para">out</p></td><td><p class="para">yes</p></td><td><p class="para">The input unchanged.</p></td></tr></tbody></table></div><div class="table"><table class="table"><thead><tr><th><p class="para">Option</p></th><th><p class="para">Rq?</p></th><th><p class="para">Default</p></th><th><p class="para">Description</p></th></tr></thead><tbody><tr><td><p class="para"><code class="code">enable</code></p></td><td><p class="para"> </p></td><td><p class="para"><code class="code">true()</code></p></td><td><p class="para">Whether the logging is done at all.</p></td></tr><tr><td><p class="para"><code class="code">href-log</code></p></td><td><p class="para">yes</p></td><td><p class="para"><code class="code"/></p></td><td><p class="para">Name of the file to write the logmessages to (must have a leading file:// specifier!)</p></td></tr><tr><td><p class="para"><code class="code">keep-messages</code></p></td><td><p class="para"> </p></td><td><p class="para"><code class="code">100</code></p></td><td><p class="para">The number of messages to keep in the logfile. If le 0, all messages are kept. Set by default to 100 to prevent overflowing files...</p></td></tr><tr><td><p class="para"><code class="code">message</code></p></td><td><p class="para">yes</p></td><td><p class="para"><code class="code"/></p></td><td><p class="para">The actual log message</p></td></tr><tr><td><p class="para"><code class="code">status</code></p></td><td><p class="para"> </p></td><td><p class="para"><code class="code">'ok'</code></p></td><td><p class="para">Status of the message. Must be ok, warning, error or debug.</p></td></tr></tbody></table></div><p class="bridgehead" id="common.mod.xpl-xtlc_recursive-directory-list"><a name="common.mod.xpl-xtlc_recursive-directory-list"><!----></a>Step declaration: <code class="code">xtlc:recursive-directory-list</code></p><p class="para">Returns the contents of a directory, going into sub-directories recursively. When the requested directory does not exist, it returns only a c:directory root element with @error="true".</p><p class="para">Adapated from Norman Walsh example code at https://github.com/xquery/xquerydoc/blob/master/deps/xmlcalabash/recursive-directory-list.xpl</p><div class="table"><table class="table"><thead><tr><th><p class="para">Port</p></th><th><p class="para">Type</p></th><th><p class="para">Primary?</p></th><th><p class="para">Description</p></th></tr></thead><tbody><tr><td><p class="para"><code class="code">result</code></p></td><td><p class="para">out</p></td><td><p class="para">yes</p></td><td><p class="para">The resulting directory structure listing in XML format.</p></td></tr></tbody></table></div><div class="table"><table class="table"><thead><tr><th><p class="para">Option</p></th><th><p class="para">Rq?</p></th><th><p class="para">Default</p></th><th><p class="para">Description</p></th></tr></thead><tbody><tr><td><p class="para"><code class="code">depth</code></p></td><td><p class="para"> </p></td><td><p class="para"><code class="code">-1</code></p></td><td><p class="para">The sub-directory depth to go. When le 0, all sub-directories are processed.</p></td></tr><tr><td><p class="para"><code class="code">exclude-filter</code></p></td><td><p class="para"> </p></td><td><p class="para"><code class="code"/></p></td><td><p class="para">An optional regexp exclude filter.</p></td></tr><tr><td><p class="para"><code class="code">flatten</code></p></td><td><p class="para"> </p></td><td><p class="para"><code class="code">false()</code></p></td><td><p class="para">When true, the list will be "flattened": Only c:file children within the root c:directory element. All c:file elements have a @name, @href-abs (absolute filename) and @href-rel (relative filename) attribute.</p></td></tr><tr><td><p class="para"><code class="code">include-filter</code></p></td><td><p class="para"> </p></td><td><p class="para"><code class="code"/></p></td><td><p class="para">An optional regexp include filter.</p></td></tr><tr><td><p class="para"><code class="code">path</code></p></td><td><p class="para">yes</p></td><td><p class="para"><code class="code"/></p></td><td><p class="para">The path to get the directory listing from.</p></td></tr></tbody></table></div><p class="bridgehead" id="common.mod.xpl-xtlc_remove-dir"><a name="common.mod.xpl-xtlc_remove-dir"><!----></a>Step declaration: <code class="code">xtlc:remove-dir</code></p><p class="para">Removes a full directory (since the normal processing using pxf:delete does not work properly some older Calabash versions... :-( ) When the directory does not exist everything continues without error.</p><div class="table"><table class="table"><thead><tr><th><p class="para">Port</p></th><th><p class="para">Type</p></th><th><p class="para">Primary?</p></th><th><p class="para">Description</p></th></tr></thead><tbody><tr><td><p class="para"><code class="code">source</code></p></td><td><p class="para">in</p></td><td><p class="para">yes</p></td><td><p class="para">Input, will be passed unchanged.</p></td></tr><tr><td><p class="para"><code class="code">result</code></p></td><td><p class="para">out</p></td><td><p class="para">yes</p></td><td><p class="para">The input unchanged.</p></td></tr></tbody></table></div><div class="table"><table class="table"><thead><tr><th><p class="para">Option</p></th><th><p class="para">Rq?</p></th><th><p class="para">Default</p></th><th><p class="para">Description</p></th></tr></thead><tbody><tr><td><p class="para"><code class="code">enable</code></p></td><td><p class="para"> </p></td><td><p class="para"><code class="code">true()</code></p></td><td><p class="para">Whether the removal is done at all.</p></td></tr><tr><td><p class="para"><code class="code">href-dir</code></p></td><td><p class="para">yes</p></td><td><p class="para"><code class="code"/></p></td><td><p class="para">Reference to the directory to remove.</p></td></tr></tbody></table></div><p class="bridgehead" id="common.mod.xpl-xtlc_tee"><a name="common.mod.xpl-xtlc_tee"><!----></a>Step declaration: <code class="code">xtlc:tee</code></p><p class="para">Tees the input to a file and passes it unchanged (like the Unix tee command).</p><div class="table"><table class="table"><thead><tr><th><p class="para">Port</p></th><th><p class="para">Type</p></th><th><p class="para">Primary?</p></th><th><p class="para">Description</p></th></tr></thead><tbody><tr><td><p class="para"><code class="code">source</code></p></td><td><p class="para">in</p></td><td><p class="para">yes</p></td><td><p class="para">Input to the tee.</p></td></tr><tr><td><p class="para"><code class="code">result</code></p></td><td><p class="para">out</p></td><td><p class="para">yes</p></td><td><p class="para">The input unchanged (unless $root-attribute-href was specified).</p></td></tr></tbody></table></div><div class="table"><table class="table"><thead><tr><th><p class="para">Option</p></th><th><p class="para">Rq?</p></th><th><p class="para">Default</p></th><th><p class="para">Description</p></th></tr></thead><tbody><tr><td><p class="para"><code class="code">enable</code></p></td><td><p class="para"> </p></td><td><p class="para"><code class="code">true()</code></p></td><td><p class="para">Whether to actually do the write. When false nothing happens.</p></td></tr><tr><td><p class="para"><code class="code">href</code></p></td><td><p class="para">yes</p></td><td><p class="para"><code class="code"/></p></td><td><p class="para">Name of the file to write to (must have a leading file:// specifier!)</p></td></tr><tr><td><p class="para"><code class="code">root-attribute-href</code></p></td><td><p class="para"> </p></td><td><p class="para"><code class="code">''</code></p></td><td><p class="para">If filled, $href is recorded as an attribute with this name on the root element of the original input. Must be a valid attribute name.</p></td></tr></tbody></table></div><p class="bridgehead" id="common.mod.xpl-xtlc_zip-directory"><a name="common.mod.xpl-xtlc_zip-directory"><!----></a>Step declaration: <code class="code">xtlc:zip-directory</code></p><p class="para">Zips a directory and its sub-directories into a single zip file.</p><div class="table"><table class="table"><thead><tr><th><p class="para">Port</p></th><th><p class="para">Type</p></th><th><p class="para">Primary?</p></th><th><p class="para">Description</p></th></tr></thead><tbody><tr><td><p class="para"><code class="code">result</code></p></td><td><p class="para">out</p></td><td><p class="para">yes</p></td><td><p class="para">The output of the actual zip step, listing all the files that went in</p></td></tr></tbody></table></div><div class="table"><table class="table"><thead><tr><th><p class="para">Option</p></th><th><p class="para">Rq?</p></th><th><p class="para">Default</p></th><th><p class="para">Description</p></th></tr></thead><tbody><tr><td><p class="para"><code class="code">base-path</code></p></td><td><p class="para">yes</p></td><td><p class="para"><code class="code"/></p></td><td><p class="para">Directory which contents will be stored in the zip (must have a leading file:// specifier!)</p></td></tr><tr><td><p class="para"><code class="code">href-target-zip</code></p></td><td><p class="para">yes</p></td><td><p class="para"><code class="code"/></p></td><td><p class="para">Document reference for the zip file to produce (must have a leading file:// specifier!)</p></td></tr><tr><td><p class="para"><code class="code">include-base</code></p></td><td><p class="para"> </p></td><td><p class="para"><code class="code">true()</code></p></td><td><p class="para">When true, the last part of $base-path (e.g. a/b/c ==&gt; c) is used as the root directory in the zip file.</p></td></tr></tbody></table></div></div></div>
    
    <script src="resources/jquery-1.12.4.min.js"><!--  --></script>
    <script>window.jQuery || document.write('&lt;script src="resources/jquery-1.12.4.min.js"&gt;&lt;\/script&gt;')</script>
    <script src="resources/bootstrap.min.js"><!--  --></script>
  </body>
</html>